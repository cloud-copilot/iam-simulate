[
  {
    "name": "Allow/Resource: specific resource matches request wildcard '*'",
    "request": {
      "action": "s3:GetObject",
      "resource": {
        "resource": "*",
        "accountId": "123456789012"
      },
      "principal": "arn:aws:iam::123456789012:user/test-user"
    },
    "identityPolicies": [
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::my-bucket/photo.jpg"
          }
        ]
      }
    ],
    "expected": {
      "response": "Allowed"
    }
  },
  {
    "name": "Allow/Resource: wildcard resource matches request wildcard '*'",
    "request": {
      "action": "s3:GetObject",
      "resource": {
        "resource": "*",
        "accountId": "123456789012"
      },
      "principal": "arn:aws:iam::123456789012:user/test-user"
    },
    "identityPolicies": [
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::my-bucket/*"
          }
        ]
      }
    ],
    "expected": {
      "response": "Allowed"
    }
  },
  {
    "name": "Allow/Resource: '*' resource matches request wildcard '*'",
    "request": {
      "action": "s3:GetObject",
      "resource": {
        "resource": "*",
        "accountId": "123456789012"
      },
      "principal": "arn:aws:iam::123456789012:user/test-user"
    },
    "identityPolicies": [
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "s3:GetObject",
            "Resource": "*"
          }
        ]
      }
    ],
    "expected": {
      "response": "Allowed"
    }
  },
  {
    "name": "Allow/NotResource: specific resource does not match request wildcard '*'",
    "request": {
      "action": "s3:GetObject",
      "resource": {
        "resource": "*",
        "accountId": "123456789012"
      },
      "principal": "arn:aws:iam::123456789012:user/test-user"
    },
    "identityPolicies": [
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "s3:GetObject",
            "NotResource": "arn:aws:s3:::secret-bucket/classified.txt"
          }
        ]
      }
    ],
    "expected": {
      "response": "Allowed"
    }
  },
  {
    "name": "Deny/Resource: specific resource does not match request wildcard '*'",
    "request": {
      "action": "s3:DeleteObject",
      "resource": {
        "resource": "*",
        "accountId": "123456789012"
      },
      "principal": "arn:aws:iam::123456789012:user/test-user"
    },
    "identityPolicies": [
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "*",
            "Resource": "*"
          }
        ]
      }
    ],
    "resourcePolicies": [
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Deny",
            "Action": "s3:DeleteObject",
            "Resource": "arn:aws:s3:::protected-bucket/*",
            "Principal": "*"
          }
        ]
      }
    ],
    "expected": {
      "response": "Allowed"
    }
  },
  {
    "name": "Deny/Resource: wildcard resource does not match request wildcard '*'",
    "request": {
      "action": "s3:DeleteObject",
      "resource": {
        "resource": "*",
        "accountId": "123456789012"
      },
      "principal": "arn:aws:iam::123456789012:user/test-user"
    },
    "identityPolicies": [
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "*",
            "Resource": "*"
          }
        ]
      }
    ],
    "resourcePolicies": [
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Deny",
            "Action": "s3:DeleteObject",
            "Resource": "arn:aws:s3:::my-bucket/sensitive/*",
            "Principal": "*"
          }
        ]
      }
    ],
    "expected": {
      "response": "Allowed"
    }
  },
  {
    "name": "Deny/Resource: '*' resource matches request wildcard '*'",
    "request": {
      "action": "s3:DeleteObject",
      "resource": {
        "resource": "*",
        "accountId": "123456789012"
      },
      "principal": "arn:aws:iam::123456789012:user/test-user"
    },
    "identityPolicies": [
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "*",
            "Resource": "*"
          }
        ]
      }
    ],
    "resourcePolicy": {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Effect": "Deny",
          "Action": "s3:DeleteObject",
          "Resource": "*",
          "Principal": "*"
        }
      ]
    },
    "expected": {
      "response": "ExplicitlyDenied",
      "blockedBy": ["resource"]
    }
  },
  {
    "name": "Deny/NotResource: specific resource matches request wildcard '*'",
    "request": {
      "action": "s3:GetObject",
      "resource": {
        "resource": "*",
        "accountId": "123456789012"
      },
      "principal": "arn:aws:iam::123456789012:user/test-user"
    },
    "identityPolicies": [
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "*",
            "Resource": "*"
          }
        ]
      }
    ],
    "resourcePolicies": [
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Deny",
            "Action": "s3:GetObject",
            "NotResource": "arn:aws:s3:::public-bucket/*",
            "Principal": "*"
          }
        ]
      }
    ],
    "expected": {
      "response": "Allowed"
    }
  },
  {
    "name": "EC2 specific resource matches request wildcard '*'",
    "request": {
      "action": "ec2:DescribeInstances",
      "resource": {
        "resource": "*",
        "accountId": "123456789012"
      },
      "principal": "arn:aws:iam::123456789012:user/test-user"
    },
    "identityPolicies": [
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "ec2:DescribeInstances",
            "Resource": "arn:aws:ec2:us-east-1:123456789012:instance/i-1234567890abcdef0"
          }
        ]
      }
    ],
    "expected": {
      "response": "Allowed"
    }
  },
  {
    "name": "Multiple resources with one matching request wildcard '*'",
    "request": {
      "action": "s3:GetObject",
      "resource": {
        "resource": "*",
        "accountId": "123456789012"
      },
      "principal": "arn:aws:iam::123456789012:user/test-user"
    },
    "identityPolicies": [
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "s3:GetObject",
            "Resource": [
              "arn:aws:s3:::bucket-one/*",
              "arn:aws:s3:::bucket-two/specific-file.txt",
              "arn:aws:dynamodb:us-east-1:123456789012:table/MyTable"
            ]
          }
        ]
      }
    ],
    "expected": {
      "response": "Allowed"
    }
  },
  {
    "name": "Cross-service policies with request wildcard '*'",
    "request": {
      "action": "lambda:InvokeFunction",
      "resource": {
        "resource": "*",
        "accountId": "123456789012"
      },
      "principal": "arn:aws:iam::123456789012:user/test-user"
    },
    "identityPolicies": [
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "lambda:InvokeFunction",
            "Resource": "arn:aws:lambda:us-east-1:123456789012:function:MyFunction"
          },
          {
            "Effect": "Allow",
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::my-bucket/*"
          }
        ]
      }
    ],
    "expected": {
      "response": "Allowed"
    }
  },
  {
    "name": "No matching policies for request wildcard '*' - implicit deny",
    "request": {
      "action": "s3:GetObject",
      "resource": {
        "resource": "*",
        "accountId": "123456789012"
      },
      "principal": "arn:aws:iam::123456789012:user/test-user"
    },
    "identityPolicies": [
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": "dynamodb:GetItem",
            "Resource": "arn:aws:dynamodb:us-east-1:123456789012:table/MyTable"
          }
        ]
      }
    ],
    "expected": {
      "response": "ImplicitlyDenied"
    }
  }
]
